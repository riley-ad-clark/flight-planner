@{
    ViewData["Title"] = "Home Page";
}
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/jquery/dist/jquery.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    <script type="text/javascript">

        $(document).ready(function () {
            $("#alertSuccess").hide();
            $('#alertDanger').hide();
            GetAirports();
            GetFlights();
        })

        function BookFlight() {

            $('#destinationId').val($('#arrivalAirport').val());
            $('#locationId').val($('#departureAirport').val());
        
            var flightObj = {
                DestinationId: $('#destinationId').val(),
                LocationId: $('#locationId').val(),
                NumberOfPassengers: $('#passengerNumber').val(),
                StartDate: $('#startDate').val(),
                EndDate: $('#endDate').val(),
                Id: $('#hiddenUserId').val()
            }

            console.log(flightObj);

            $.ajax({
                url: "/Home/BookFlight",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify(flightObj),
                success: function (response) {
                    console.log(response);
                    if (response == 'success') {
                        GetFlights();
                        $('#alertSuccess').show()
                    } else 
                    {
                        GetFlights();
                        $('#alertDanger').show()
                        $('#alertDanger').text("Some error occured, try again!")
                    }
                },
                error: function (errorMessage) {
                    $('#alertDanger').show()
                    $('#alertDanger').text("errorMessage.responseText")
                }
            })
        }

        function GetAirports() {
            $.ajax({
                url: "/Home/GetAirports",
                type: "GET",
                contentType: "application/json",
                dataType: "json",
                success: function (response) {
                    console.log(response);
                    var dropdown = $('.airportDropdown');
                    dropdown.empty();
                    $.each(response, function (index, item) {
                        dropdown.append($('<option></option>').attr('value', item.value).text(item.text));
                    });
                },
                error: function (error) {
                    alert('Error fetching airports: ' + error);
                }
            })
        }

        function GetFlights() {
            $.ajax({
                url: "/Home/GetFlights",
                type: "GET",
                contentType: "application/json",
                dataType: "json",
                success: function (response) {
                    console.log(response);
                    var html = '';
                    $.each(response, function (key, item) {
                        console.log(response);
                        html += '<tr>';
                        html += '<td>' + item.departure + '</td>';
                        html += '<td>' + item.arrival + '</td>';
                        html += '<td>' + item.departureDate + '</td>';
                        html += '<td>' + item.arrivalDate + '</td>';
                        html += '</tr>';
                    });
                    $('.tbody').html(html);
                },
                error: function (errormessage) {
                    alert(errormessage.responseText);
                }
            })
        }

    </script>
</head>

    <div class="photo-background-container" style="position: relative; width: 100%; height: 500px; overflow: hidden;">
        <div class="overlay" style="position: absolute; background: rgba(0, 0, 0, 0.7); width: 100%; height: 100%; top: 0; left: 0; z-index: 1;"></div>
        <img src="~/images/hero-02.jpg" style="object-fit: cover; width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 0;">
        <div class="container" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 2;">
            <center><h1 style="font-size: 75px; color: #fff; margin-bottom: 40px;">Adventure calls, will you answer?</h1></center>
            <input type="hidden" id="hiddenUserId" value="@ViewBag.UserId" />
            <form class="d-flex flex-row align-items-center justify-content-center" style="gap: 15px;">
                <span hidden id="locationId"></span>
                <select class="airportDropdown form-control form-control-lg rounded-pill" id="departureAirport" style="width: 250px;">
                    <option value="" disabled selected>Departure Airport</option>
                </select>
                    <i class="fa-solid fa-arrow-right" style="font-size: 25px; color: #fff;"></i>
                <span hidden id="destinationId"></span>
                <select class="airportDropdown form-control form-control-lg rounded-pill" id="arrivalAirport" style="width: 250px;">
                    <option value="" disabled selected>Arrival Airport</option>
                </select>

                <span style="color: #fff; font-size: 25px; margin-bottom: 5px;">|</span>

                <input type="date" class="form-control form-control-lg rounded-pill" id="startDate" style="width: 200px;" />
                    <i class="fa-solid fa-arrow-right-arrow-left" style="font-size: 25px; color: #fff;"></i>
                <input type="date" class="form-control form-control-lg rounded-pill" id="endDate" style="width: 200px;"/>

                <div class="input-group" style="width: 100px;">
                    <input type="number" class="form-control form-control-lg rounded-pill" id="passengerNumber" value="0" min="0" max="25">
                </div>

                <button type="button" class="btn btn-primary rounded-pill btn-lg" style="height: 100%;" id="btnAdd" onclick="BookFlight()">Book It!</button>
                <i class="fa-solid fa-square-check" id="alertSuccess" style="font-size: 60px; color: #fcba03"></i>
            </form>
            <div class="col-md-6">
                <div class="alert alert-danger" id="alertDanger"></div>
            </div>
        </div>
    </div>


    <div class="container" style="margin-top: 30px;">
        <div class="table-holder justify-content-center align-items-center">
            <center><h3>Upcoming flights</h3></center>
            <table class="table table-bordered table-hover">
                <thead>
                    <tr>
                        <td>Departure</td>
                        <td>Arrival</td>
                        <td>Departure Date</td>
                        <td>Arrival Date</td>
                    </tr>
                </thead>
                <tbody class="tbody">
                    @*Booking records will to populated here*@
                </tbody>
            </table>
        </div>
    </div>



